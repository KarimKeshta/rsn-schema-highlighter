{
    "name": "Relational Schema Notation",
    "scopeName": "source.rsn",
    "fileTypes": ["rsn"],
    "patterns": [
        {"include": "#main"}
    ],
    "repository": {
        "main": {
            "patterns": [
                {"include": "#foreign_key_source_block"},
                {"include": "#foreign_key_target_block"},
                {"include": "#candidate_keys_block"},
                {"include": "#table_definition"},
                
                {"include": "#candidate_key_indicator"},
                {"include": "#constraints"},
                {"include": "#entity_name"},
                {"include": "#operators"},
                {"include": "#delimiters"},
                {"include": "#attribute_list"}
            ]
        },
        "table_definition": {
            "name": "meta.table-attribute-definition.rsn",
            "begin": "\\s*\\(", 
            "end": "\\)",
            "beginCaptures": {
                "0": { "name": "punctuation.separator.rsn" }
            },
            "endCaptures": {
                "0": { "name": "punctuation.separator.rsn" }
            },
            "patterns": [
                {"include": "#primary_key_attribute_definition"},
                {
                    "name": "entity.name.key.foreign.rsn",
                    "match": "\\b[A-Za-z0-9_]*(?:ID|Id)\\b"
                },
                {"include": "#attribute_list"},
                {"include": "#delimiters"}
            ]
        },
        "entity_name": {
            "name": "entity.name.class.rsn",
            "match": "\\b[A-Z][A-Za-z0-9_]*\\b(?=\\s*\\()"
        },

        "attribute_list": {
            "name": "meta.text.plain.rsn", 
            "match": "\\b[A-Za-z][A-Za-z0-9_]*\\b"
        },

        "operators": {
            "name": "keyword.operator.rsn",
            "match": "(<=|=>|=|<|>|->)"
        },

        "candidate_key_indicator": {
            "name": "constant.language.indicator.rsn",
            "match": "\\bX\\b"
        },

        "constraints": {
            "patterns": [
                {
                    "name": "keyword.control.rsn",
                    "match": "\\b(NOT NULL|CHECK)\\b"
                },
                {
                    "name": "constant.numeric.rsn",
                    "match": "\\b\\d+\\b"
                }
            ]
        },

        "delimiters": {
            "name": "punctuation.separator.rsn",
            "match": "(,|\\(|\\)|{|}\\[|\\])"
        },
        "primary_key_attribute_definition": {
            "match": "(_)([A-Za-z0-9]+)(_)",
            "captures": {
                "1": { "name": "punctuation.definition.hidden.rsn" },
                "2": { "name": "entity.name.key.primary.rsn" },
                "3": { "name": "punctuation.definition.hidden.rsn" }
            }
        },
        "foreign_key_source_block": {
            "match": "(\\()([A-Za-z0-9_]+)(\\))\\s*(->)",
            "captures": {
                "1": { "name": "punctuation.separator.rsn" },
                "2": { "name": "entity.name.key.foreign.source.rsn" },
                "3": { "name": "punctuation.separator.rsn" },
                "4": { "name": "keyword.operator.rsn" }
            }
        },
        "foreign_key_target_block": {
            "match": "\\b([A-Za-z][A-Za-z0-9_]*)\\s*(\\()([A-Za-z0-9_]+)(\\))",
            "captures": {
                "1": { "name": "entity.name.class.rsn" },
                "2": { "name": "punctuation.separator.rsn" },
                "3": { "name": "entity.name.key.primary.target.rsn" },
                "4": { "name": "punctuation.separator.rsn" }
            }
        },
        "candidate_keys_block": {
            "begin": "\\{",
            "end": "\\}",
            "beginCaptures": {
                "0": { "name": "punctuation.separator.rsn" }
            },
            "endCaptures": {
                "0": { "name": "punctuation.separator.rsn" }
            },
            "patterns": [
                {
                    "match": ",",
                    "name": "punctuation.separator.rsn"
                },
                {
                    "match": "[A-Za-z0-9_]+",
                    "name": "entity.name.key.candidate.rsn"
                }
            ]
        }
    }
}