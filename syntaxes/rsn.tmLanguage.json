{
    "scopeName": "source.rsn",
    "fileTypes": ["rsn"],
    "name": "Relational Schema Notation",
    
    "patterns": [
        {"include": "#main"}
    ],

    "repository": {
        "main": {
            "patterns": [
                {"include": "#foreign_key_source_block"},
                {"include": "#foreign_key_target_block"},
                {"include": "#candidate_keys_block"},
                {"include": "#table_definition"}, 
                
                {"include": "#candidate_key_indicator"},
                {"include": "#constraints"},     
                {"include": "#entity_name"},
                {"include": "#operators"},
                {"include": "#delimiters"},
                {"include": "#attribute_list"}
            ]
        },
        "table_definition": {
            "name": "meta.table-attribute-definition.rsn",
            "begin": "\\s*\\(", 
            "end": "\\)",
            "beginCaptures": {
                "0": { "name": "punctuation.definition.parameters.rsn" }
            },
            "endCaptures": {
                "0": { "name": "punctuation.definition.parameters.rsn" }
            },
            "patterns": [
                {"include": "#primary_key_attribute_definition"},
                {
                    "name": "storage.type.key.foreign.rsn",
                    "match": "\\b[A-Za-z0-9_]*(?:ID|Id)\\b"
                },
                {"include": "#attribute_list"},
                {"include": "#delimiters"}
            ]
        },
        "entity_name": {
            "name": "entity.name.type.rsn",
            "match": "\\b[A-Z][A-Za-z0-9_]*\\b(?=\\s*\\()"
        },

        "attribute_list": {
            "name": "text.plain.rsn", 
            "match": "\\b[A-Za-z][A-Za-z0-9_]*\\b"
        },

        "operators": {
            "name": "keyword.operator.rsn",
            "match": "(<=|>=|=|<|>|->)"
        },

        "candidate_key_indicator": {
            "name": "constant.language.x.rsn",
            "match": "\\bX\\b"
        },

        "constraints": {
            "patterns": [
                {
                    "name": "keyword.control.rsn",
                    "match": "\\b(NOT NULL|X|UNIQUE|FOREIGN KEY|REFERENCES)\\b"
                },
                {
                    "name": "constant.numeric.rsn",
                    "match": "\\b\\d+\\b"
                }
            ]
        },

        "delimiters": {
            "patterns": [
                {
                    "name": "punctuation.definition.parameters.rsn",
                    "match": "[{}]"
                },
                {
                    "name": "punctuation.definition.begin.rsn",
                    "match": "\\("
                },
                {
                    "name": "punctuation.definition.end.rsn",
                    "match": "\\)"
                },
                {
                    "name": "punctuation.separator.comma.rsn",
                    "match": ","
                }
            ]
        },
        "primary_key_attribute_definition": {
            "match": "(_)([A-Za-z0-9]+)(_)",
            "captures": {
                "1": { "name": "punctuation.definition.key.hidden.rsn" },
                "2": { "name": "storage.type.key.primary.rsn" },
                "3": { "name": "punctuation.definition.key.hidden.rsn" }
            }
        },
        "foreign_key_source_block": {
            "match": "(\\()([A-Za-z0-9_]+)(\\))\\s*(->)",
            "captures": {
                "1": { "name": "punctuation.definition.parameters.rsn" },
                "2": { "name": "storage.type.key.foreign.source.rsn" },
                "3": { "name": "punctuation.definition.parameters.rsn" },
                "4": { "name": "keyword.operator.rsn" }
            }
        },
        "foreign_key_target_block": {
            "match": "\\b([A-Za-z][A-Za-z0-9_]*)\\s*(\\()([A-Za-z0-9_]+)(\\))",
            "captures": {
                "1": { "name": "entity.name.type.rsn" },
                "2": { "name": "punctuation.definition.parameters.rsn" },
                "3": { "name": "storage.type.key.foreign.target.rsn" },
                "4": { "name": "punctuation.definition.parameters.rsn" }
            }
        },
        "candidate_keys_block": {
            "begin": "\\{",
            "end": "\\}",
            "beginCaptures": {
                "0": { "name": "punctuation.definition.parameters.rsn" }
            },
            "endCaptures": {
                "0": { "name": "punctuation.definition.parameters.rsn" }
            },
            "patterns": [
                {
                    "match": ",",
                    "name": "punctuation.separator.comma.rsn"
                },
                {
                    "match": "[A-Za-z0-9_]+",
                    "name": "variable.key.candidate.rsn"
                }
            ]
        }
    }
}